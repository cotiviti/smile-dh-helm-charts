{{- $lokiConfig := include "observability.lokideployment.config" . | fromYaml -}}
{{- if $lokiConfig.enabled -}}
{{- /* if (include "observability.lokideployment.enabled" . | fromYaml) */ -}}
apiVersion: v1
kind: Service
metadata:
  # name: {{ .Release.Name }}-loki
  name: loki
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "smilecdr.labels" $ | nindent 4 }}
  annotations: {}
spec:
  type: "ClusterIP"
  ports:
    - name: loki
      port: 3100
      targetPort: loki
      protocol: TCP
  selector:
    app: loki
    release: {{ .Release.Name }}
---
apiVersion: v1
kind: Service
metadata:
  # name: {{ .Release.Name }}-loki
  name: loki-memberlist
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "smilecdr.labels" $ | nindent 4 }}
  annotations: {}
spec:
  type: "ClusterIP"
  # clusterIP: None
  ports:
    - name: tcp
      port: 7946
      targetPort: http-memberlist
      protocol: TCP

  selector:
    app: loki
    release: {{ .Release.Name }}
{{- end -}}
