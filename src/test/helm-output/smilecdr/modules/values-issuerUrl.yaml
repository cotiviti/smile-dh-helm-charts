modules:
  useDefaultModules: false
  clustermgr:
    name: Modified Cluster Manager Configuration
    config:
      db.driver: POSTGRES_9_5
    # Fhir Endpoint
  security_out_smart:
    enabled: true
    type: SECURITY_OUT_SMART
    requires:
      SECURITY_IN_UP: local_security
    config:
      port: 9300
      openid.signing.keystore_id: default-keystore
      enforce_approved_scopes_to_restrict_permissions: false
      cors.enable: true
      federate_mode.enabled: true
      issuer.url: https://my-issuer-url/path
  fhir_endpoint:
    name: FHIR Service
    enabled: true
    type: ENDPOINT_FHIR_REST_R4
    enableReadinessProbe: true
    service:
      enabled: true
      svcName: fhir
      hostName: default
    requires:
      PERSISTENCE_R4: persistence
      SECURITY_IN_UP: local_security
    config:
      context_path: fhir_request
      port: 8000
  persistence:
    name: Database Configuration
    enabled: true
    type: PERSISTENCE_R4
    config:
      db.driver: POSTGRES_9_4
      db.url: jdbc:postgresql://#{env['DB_URL']}:#{env['DB_PORT']/#{env['DB_DATABASE']}?sslmode=require
      db.password: "#{env['DB_PASS']}"
      db.username: "#{env['DB_USER']}"
  local_security:
    name: Local Storage Inbound Security
    enabled: true
    type: SECURITY_IN_LOCAL
    config:
      seed.users.file: classpath:/config_seeding/users.json
      # This is required right now as the default is not being honored.
      # Can be removed if the default gets fixed. May be good to leave it explicit.
      # Note: Smile CDR still chooses the wrong default as of `2022.11.R01`
      password_encoding_type: BCRYPT_12_ROUND

ingresses:
  default:
    enabled: true
