# This tests DB environments for multiple internally provisioned CrunchyData DB

database:
  crunchypgo:
    enabled: true
    internal: true
    config:
      postgresVersion: 14
      instanceReplicas: 1
      instanceCPU: 1
      instanceMemory: 2Gi
      instanceSize: 10Gi
      backupsSize: 10Gi
    users:
    - name: smilecdr
      module: clustermgr
    - name: persistence
      module: persistence

modules:
  usedefaultmodules: false
  clustermgr:
    name: Cluster Manager Configuration
    enabled: true
    config:
      db.driver: POSTGRES_9_4
      db.url: jdbc:postgresql://#{env['DB_URL']}:#{env['DB_PORT']/#{env['DB_DATABASE']}?sslmode=require
      db.password: "#{env['DB_PASS']}"
      db.username: "#{env['DB_USER']}"

  persistence:
    name: Database Configuration
    enabled: true
    type: PERSISTENCE_R4
    config:
      db.driver: POSTGRES_9_4
      db.url: jdbc:postgresql://#{env['DB_URL']}:#{env['DB_PORT']/#{env['DB_DATABASE']}?sslmode=require
      db.password: "#{env['DB_PASS']}"
      db.username: "#{env['DB_USER']}"
  admin_web:
    name: Web Admin
    enabled: true
    type: ADMIN_WEB
    service:
      enabled: true
      svcName: admin-web
      hostName: default
    requires:
      SECURITY_IN_UP: local_security
    config:
      context_path: ""
      port: 9100
      tls.enabled: false
      https_forwarding_assumed: true
      respect_forward_headers: true

autoDeploy: false

ingress:
  enabled: false
