# This tests DB environments for multiple external DB

database:
  crunchypgo:
    enabled: false
  external:
    enabled: true
    databases:
    - secretName: smilecdrSecret
      module: clustermgr
      url: thedatabaseurl
      dbType: postgres
      port: 5432
      dbname: cdr
      username: username
      passKey: password
    - secretName: smilecdrSecret2
      module: clustermgr2
      host: thedatabasehost
      dbType: postgres
      port: 5432
      dbname: cdr
      user: username
      passKey: password
    - secretName: smilecdrSecret3
      module: persistence
      urlKey: host
      dbTypeKey: type
      portKey: port
      dbnameKey: dbname
      userKey: user
      passKey: password
    - secretName: smilecdrSecret4
      module: persistence2
      hostKey: host
      dbTypeKey: type
      portKey: port
      dbnameKey: dbname
      usernameKey: user
      passKey: password
    - secretName: smilecdrSecret5
      module: persistence3

modules:
  useDefaultModules: false
  clustermgr:
    name: Cluster Manager Configuration
    enabled: true
    config:
      db.driver: POSTGRES_9_4
      db.url: jdbc:postgresql://#{env['DB_URL']}:#{env['DB_PORT']/#{env['DB_DATABASE']}?sslmode=require
      db.password: "#{env['DB_PASS']}"
      db.username: "#{env['DB_USER']}"

  persistence:
    name: Database Configuration
    enabled: true
    type: PERSISTENCE_R4
    config:
      db.driver: POSTGRES_9_4
      db.url: jdbc:postgresql://#{env['DB_URL']}:#{env['DB_PORT']/#{env['DB_DATABASE']}?sslmode=require
      db.password: "#{env['DB_PASS']}"
      db.username: "#{env['DB_USER']}"
  admin_web:
    name: Web Admin
    enabled: true
    type: ADMIN_WEB
    enableReadinessProbe: true
    service:
      enabled: true
      svcName: admin-web
      hostName: default
    requires:
      SECURITY_IN_UP: local_security
    config:
      context_path: ""
      port: 9100
      tls.enabled: false
      https_forwarding_assumed: true
      respect_forward_headers: true
  local_security:
    name: Local Storage Inbound Security
    enabled: true
    type: SECURITY_IN_LOCAL
    config:
      seed.users.file: classpath:/config_seeding/users.json
      # This is required right now as the default is not being honored.
      # Can be removed if the default gets fixed. May be good to leave it explicit.
      # Note: Smile CDR still chooses the wrong default as of `2022.11.R01`
      password_encoding_type: BCRYPT_12_ROUND

autoDeploy: false

ingress:
  enabled: false
