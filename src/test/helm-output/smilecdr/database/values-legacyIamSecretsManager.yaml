# This tests DB environments using RDS with IAM and Secrets Manager configuration

# An older CDR version is pinned to an older version as this test uses the
# legacy IAM mechanism rather than the newer mechanism that uses the
# AWS Advanced JDBC Driver that was introduced in Smile CDR 2025.05.R01
cdrVersion: 2025.02.R01

database:
  crunchypgo:
    enabled: false
  external:
    enabled: true
    defaults:
      connectionConfigSource:
        source: sscsi
        provider: aws
        secretArn: "arn:aws:secretsmanager:us-east-1:1234567890:secret:secretname"
        secretName: smilecdrSecretp
    databases:
    - name: clustermgrdb-iam
      modules:
      - clustermgr
      connectionConfig:
        authentication:
          type: iam
          provider: aws
    - name: persistence-iam-sscsi
      modules:
        - persistence
      connectionConfig:
        authentication:
          type: secretsmanager
          provider: aws
