## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.3.7 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 5.35.0 |
| <a name="requirement_helm"></a> [helm](#requirement\_helm) | >= 2.12.1 |
| <a name="requirement_kubernetes"></a> [kubernetes](#requirement\_kubernetes) | >= 2.25.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | >= 5.35.0 |
| <a name="provider_helm"></a> [helm](#provider\_helm) | >= 2.12.1 |
| <a name="provider_kubernetes"></a> [kubernetes](#provider\_kubernetes) | >= 2.25.0 |
| <a name="provider_random"></a> [random](#provider\_random) | n/a |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_aws_region"></a> [aws\_region](#input\_aws\_region) | Region of the EKS cluster | `string` | `null` | no |
| <a name="input_cdr_license_secret_arn"></a> [cdr\_license\_secret\_arn](#input\_cdr\_license\_secret\_arn) | ARN for AWS Secret for Smile CDR License. If not specified, a secret will be created | `string` | `null` | no |
| <a name="input_cdr_license_secret_kms_arn"></a> [cdr\_license\_secret\_kms\_arn](#input\_cdr\_license\_secret\_kms\_arn) | ARN for KMS key for existing AWS Secrets Manager secret for Smile CDR License. | `string` | `null` | no |
| <a name="input_cdr_license_secret_name"></a> [cdr\_license\_secret\_name](#input\_cdr\_license\_secret\_name) | Name to use when creating secret for Smile CDR License | `string` | `"license"` | no |
| <a name="input_cdr_license_secret_name_override"></a> [cdr\_license\_secret\_name\_override](#input\_cdr\_license\_secret\_name\_override) | Set true to prevent random suffix on Smile CDR License secret name | `bool` | `false` | no |
| <a name="input_cdr_regcred_secret_arn"></a> [cdr\_regcred\_secret\_arn](#input\_cdr\_regcred\_secret\_arn) | ARN for existing AWS Secrets Manager secret for registry credentials. If not specified, a secret will be created | `string` | `null` | no |
| <a name="input_cdr_regcred_secret_kms_arn"></a> [cdr\_regcred\_secret\_kms\_arn](#input\_cdr\_regcred\_secret\_kms\_arn) | ARN for KMS key for existing AWS Secrets Manager secret for registry credentials. | `string` | `null` | no |
| <a name="input_cdr_regcred_secret_name"></a> [cdr\_regcred\_secret\_name](#input\_cdr\_regcred\_secret\_name) | Name to use when creating secret for Docker pull | `string` | `"regcred"` | no |
| <a name="input_cdr_regcred_secret_name_override"></a> [cdr\_regcred\_secret\_name\_override](#input\_cdr\_regcred\_secret\_name\_override) | Set true to prevent random suffix on Docker pull secret name | `bool` | `false` | no |
| <a name="input_cdr_service_account_name"></a> [cdr\_service\_account\_name](#input\_cdr\_service\_account\_name) | Override auto-generated service account name | `string` | `null` | no |
| <a name="input_create_copyfiles_bucket"></a> [create\_copyfiles\_bucket](#input\_create\_copyfiles\_bucket) | Enable creation of S3 bucket suitable for CopyFiles function | `bool` | `false` | no |
| <a name="input_crunchy_pgo_config"></a> [crunchy\_pgo\_config](#input\_crunchy\_pgo\_config) | CrunchyData PGO backup & restore configuration | <pre>object({<br>    enabled                       = optional(bool)<br>    helm_autoconf                 = optional(bool,true)<br>    pgbackrest                    = optional(object({<br>      enabled                     = optional(bool,false)<br>      volume                      = optional(object({<br>        backupsSize               = optional(string,"1Gi")<br>        retention_full            = optional(number,3)<br>        retention_incremental     = optional(number)<br>        retention_differential    = optional(number)<br>        manual_backup             = optional(string)<br>      }))<br>      s3                          = optional(object({<br>        enabled                   = optional(bool,false)<br>        use_existing_bucket       = optional(bool,false)<br>        bucket_name               = optional(string)<br>        bucket_name_prefix        = optional(string)<br>        bucket_prefix             = optional(string,"pgbackrest")<br>        reponumber                = optional(number,2)<br>        reponame                  = optional(string)<br>        retain_on_destroy         = optional(bool,false)<br>        retention_full            = optional(number,10)<br>        retention_incremental     = optional(number)<br>        retention_differential    = optional(number)<br>        manual_backup             = optional(string)<br>      }),{enabled=false})<br>      schedules                   = optional(object({<br>        full                      = optional(string)<br>        incremental               = optional(string)<br>        differential              = optional(string)<br>      }))<br>    }))<br>    restore                       = optional(object({<br>      enabled                     = optional(bool,false)<br>      source                      = optional(string)<br>      type                        = optional(string,"time")<br>      restore_time                = optional(string)<br>    }))<br>    datasource                    = optional(any)<br>  })</pre> | <pre>{<br>  "pgbackrest": {<br>    "enabled": false<br>  }<br>}</pre> | no |
| <a name="input_db_instance_defaults"></a> [db\_instance\_defaults](#input\_db\_instance\_defaults) | Default configuration for databases. | <pre>object({<br>    db_subnet_discovery_tags      = optional(map(string))<br>    db_subnet_discovery_enabled   = optional(bool,true)<br>    db_subnet_ids                 = optional(list(string))<br>    db_subnet_group_name          = optional(string)<br>    engine                        = optional(string,"aurora-postgresql-serverless-v2")<br>    enable_cdr_rds_secrets        = optional(bool,true)<br>    publicly_accessible           = optional(bool,false)<br><br>  })</pre> | <pre>{<br>  "enable_cdr_rds_secrets": true,<br>  "engine": "aurora-postgresql-serverless-v2"<br>}</pre> | no |
| <a name="input_db_instances"></a> [db\_instances](#input\_db\_instances) | n/a | <pre>list(object({<br>    name                          = string<br>    db_subnet_discovery_tags      = optional(map(string))<br>    db_subnet_discovery_enabled   = optional(bool)<br>    db_subnet_ids                 = optional(list(string))<br>    db_subnet_group_name          = optional(string)<br>    engine                        = optional(string)<br>    enable_cdr_rds_secrets        = optional(bool)<br>    name_suffix                   = optional(string)<br>    name_override                 = optional(string)<br>    publicly_accessible           = optional(bool)<br>    public_cidr_blocks            = optional(list(string))<br>    rds_kms_arn                   = optional(string)<br>    kms_deletion_window           = optional(number)<br>    secrets_kms_key_arn           = optional(string)<br>    master_username               = optional(string)<br>    manage_master_user_password   = optional(bool)<br>    dbname                        = optional(string)<br>    dbport                        = optional(number)<br>    default_auth_type             = optional(string)<br><br>  }))</pre> | `[]` | no |
| <a name="input_db_subnet_ids"></a> [db\_subnet\_ids](#input\_db\_subnet\_ids) | Subnet IDs where the Database will be located. If this is left null then an existing db\_seubnet\_group MUST be provided with db\_subnet\_group\_name. | `list(string)` | `[]` | no |
| <a name="input_db_use_old_helm_schema"></a> [db\_use\_old\_helm\_schema](#input\_db\_use\_old\_helm\_schema) | Subnet IDs where the Database will be located. If this is left null then an existing db\_seubnet\_group MUST be provided with db\_subnet\_group\_name. | `bool` | `true` | no |
| <a name="input_db_users"></a> [db\_users](#input\_db\_users) | n/a | <pre>list(object({<br>    db_instance_name              = string<br>    name                          = string<br>    cdr_modules                   = optional(list(string))<br>    dbusername                    = optional(string)<br>    dbname                        = optional(string)<br>    auth_type                     = optional(string,"password")<br><br>  }))</pre> | `[]` | no |
| <a name="input_db_vpc_id"></a> [db\_vpc\_id](#input\_db\_vpc\_id) | ID of VPC to create Database in. Uses the same VPC as the EKS cluster by default | `string` | `null` | no |
| <a name="input_eks_cluster_ca_certificate"></a> [eks\_cluster\_ca\_certificate](#input\_eks\_cluster\_ca\_certificate) | Override auto-detected EKS Cluster CA Certificate. This must be a base64 encoded certificate. | `string` | `null` | no |
| <a name="input_eks_cluster_endpoint"></a> [eks\_cluster\_endpoint](#input\_eks\_cluster\_endpoint) | Override auto-detected EKS Cluster endpoint | `string` | `null` | no |
| <a name="input_eks_cluster_name"></a> [eks\_cluster\_name](#input\_eks\_cluster\_name) | Name of the EKS cluster to install Smile CDR | `string` | n/a | yes |
| <a name="input_eks_cluster_oidc_provider_arn"></a> [eks\_cluster\_oidc\_provider\_arn](#input\_eks\_cluster\_oidc\_provider\_arn) | Override auto-detected EKS OIDC Provider ARN e.g., arn:aws:iam::<ACCOUNT-ID>:oidc-provider/<var.eks\_oidc\_provider> | `string` | `null` | no |
| <a name="input_eks_cluster_oidc_provider_url"></a> [eks\_cluster\_oidc\_provider\_url](#input\_eks\_cluster\_oidc\_provider\_url) | Override auto-detected EKS OIDC Provider URL e.g., https://oidc.eks.<region.amazonaws.com/id/<ID> | `string` | `null` | no |
| <a name="input_eks_cluster_security_group_id"></a> [eks\_cluster\_security\_group\_id](#input\_eks\_cluster\_security\_group\_id) | Security group ID for EKS Cluster | `string` | `null` | no |
| <a name="input_eks_cluster_version"></a> [eks\_cluster\_version](#input\_eks\_cluster\_version) | Override auto-detected EKS Cluster version | `string` | `null` | no |
| <a name="input_enable_cdr_license_secret"></a> [enable\_cdr\_license\_secret](#input\_enable\_cdr\_license\_secret) | Use AWS Secrets Manager for Smile CDR License Secret | `bool` | `false` | no |
| <a name="input_enable_cdr_rds_secrets"></a> [enable\_cdr\_rds\_secrets](#input\_enable\_cdr\_rds\_secrets) | Use AWS Secrets Manager for RDS Secrets | `bool` | `true` | no |
| <a name="input_enable_cdr_regcred_secret"></a> [enable\_cdr\_regcred\_secret](#input\_enable\_cdr\_regcred\_secret) | Disable handling of secrets for registry credentials | `bool` | `true` | no |
| <a name="input_enable_irsa"></a> [enable\_irsa](#input\_enable\_irsa) | Override auto-detected EKS Cluster version | `bool` | `null` | no |
| <a name="input_extra_iam_policies"></a> [extra\_iam\_policies](#input\_extra\_iam\_policies) | n/a | `map(map(any))` | `{}` | no |
| <a name="input_extra_secrets"></a> [extra\_secrets](#input\_extra\_secrets) | n/a | `list(any)` | `[]` | no |
| <a name="input_helm_chart"></a> [helm\_chart](#input\_helm\_chart) | The name of the Smile CDR Helm Chart in the repository | `string` | `"smilecdr"` | no |
| <a name="input_helm_chart_mapped_files"></a> [helm\_chart\_mapped\_files](#input\_helm\_chart\_mapped\_files) | List of files & data to include in the classes & customerlib directories. | <pre>list(object(<br>    {<br>      name     = string<br>      data     = string<br>      location = string<br>    }<br>  ))</pre> | `[]` | no |
| <a name="input_helm_chart_values"></a> [helm\_chart\_values](#input\_helm\_chart\_values) | List of raw yaml values files to pass in to the Helm Chart. These will be merged into the final Helm Values. | `list(string)` | `[]` | no |
| <a name="input_helm_chart_values_set_overrides"></a> [helm\_chart\_values\_set\_overrides](#input\_helm\_chart\_values\_set\_overrides) | Individual values overrides to pass in to the Helm Chart. Each item in the provided map is equivalent to using the --set option with the helm command. | `map(string)` | `{}` | no |
| <a name="input_helm_chart_version"></a> [helm\_chart\_version](#input\_helm\_chart\_version) | The version of the Smile CDR Helm Chart to use | `string` | `"1.0.0-pre.110"` | no |
| <a name="input_helm_deploy"></a> [helm\_deploy](#input\_helm\_deploy) | Deploy using the Smile CDR Helm Chart | `bool` | `true` | no |
| <a name="input_helm_release_name"></a> [helm\_release\_name](#input\_helm\_release\_name) | The release name used in the Smile CDR Helm Chart | `string` | `"smilecdr"` | no |
| <a name="input_helm_repository"></a> [helm\_repository](#input\_helm\_repository) | The Helm Repo where the Smile CDR Helm Chart is hosted | `string` | `"{{ helm_repo_stable }}"` | no |
| <a name="input_helm_service_account_suffix"></a> [helm\_service\_account\_suffix](#input\_helm\_service\_account\_suffix) | The suffix used for ServiceAccount in the Smile CDR Helm Chart | `string` | `"-smilecdr"` | no |
| <a name="input_ingress_config"></a> [ingress\_config](#input\_ingress\_config) | Configuration for DNS | <pre>map(object(<br>    {<br>      hostname                = optional(string,"")<br>      parent_domain           = optional(string,"")<br>      route53_create_record   = optional(bool,true)<br>      route53_zone_name       = optional(string)<br>    }<br>  ))</pre> | `{}` | no |
| <a name="input_kms_deletion_window"></a> [kms\_deletion\_window](#input\_kms\_deletion\_window) | Deletion Window for KMS. Set from 7 to 30 | `number` | `7` | no |
| <a name="input_mock_data_aws_eks_cluster"></a> [mock\_data\_aws\_eks\_cluster](#input\_mock\_data\_aws\_eks\_cluster) | Mock unit-testing data for aws\_eks\_cluster data source | <pre>object(<br>    {<br>      arn                               = optional(string)<br>      access_config                     = optional(list(object(<br>        {<br>          authentication_mode           = string<br>        }<br>      )))<br>      certificate_authority             = optional(list(object(<br>        {<br>          data                          = string<br>        }<br>      )))<br>      created_at                        = optional(string)<br>      enabled_cluster_log_types         = optional(set(string))<br>      endpoint                          = optional(string)<br>      id                                = optional(string)<br>      cluster_id                        = optional(string)<br>      identity                          = optional(list(object(<br>        {<br>          oidc=list(object(<br>            {<br>              issuer                    = string<br>            }<br>          ))<br>        }<br>      )))<br>      kubernetes_network_config         = optional(list(object(<br>        {<br>          ip_family                     = string<br>          service_ipv4_cidr             = string<br>          service_ipv6_cidr             = string<br>        }<br>      )))<br>      name                              = optional(string)<br>      outpost_config                    = optional(list(object(<br>        {<br>          control_plane_instance_type   = string<br>          control_plane_placement       = list(object(<br>            {<br>              group_name                = string<br>            }<br>          ))<br>          outpost_arns                  = set(string)<br>        }<br>      )))<br>      platform_version                  = optional(string)<br>      role_arn                          = optional(string)<br>      status                            = optional(string)<br>      version                           = optional(string)<br>      vpc_config                        = optional(list(object(<br>        {<br>          cluster_security_group_id     = string<br>          endpoint_private_access       = optional(bool)<br>          endpoint_public_access        = optional(bool)<br>          public_access_cidrs           = optional(set(string))<br>          security_group_ids            = optional(set(string))<br>          subnet_ids                    = optional(set(string))<br>          vpc_id                        = string<br>        }<br>      )))<br>      tags                              = optional(object({}))<br>    }<br>  )</pre> | `{}` | no |
| <a name="input_mock_data_aws_iam_openid_connect_provider"></a> [mock\_data\_aws\_iam\_openid\_connect\_provider](#input\_mock\_data\_aws\_iam\_openid\_connect\_provider) | Mock unit-testing data for aws\_iam\_openid\_connect\_provider data source | <pre>object(<br>    {<br>      arn                               = optional(string)<br>      client_id_list                    = optional(list(string))<br>      thumbprint_list                   = optional(list(string))<br>      id                                = optional(string)<br>      url                               = optional(string)<br>      tags                              = optional(map(string))<br>    }<br>  )</pre> | `{}` | no |
| <a name="input_name"></a> [name](#input\_name) | Unique identifier for this Smile CDR instance | `string` | n/a | yes |
| <a name="input_namespace"></a> [namespace](#input\_namespace) | The Namespace this will be deployed in | `string` | `null` | no |
| <a name="input_prod_mode"></a> [prod\_mode](#input\_prod\_mode) | Sets some sane defaults for environments being deployed into production | `bool` | `true` | no |
| <a name="input_rds_kms_arn"></a> [rds\_kms\_arn](#input\_rds\_kms\_arn) | ARN for KMS key used for RDS. If not specified, one will be created | `string` | `null` | no |
| <a name="input_resourcenames_suffix"></a> [resourcenames\_suffix](#input\_resourcenames\_suffix) | Set suffix on generated resource names. Will generate random suffix if not set. | `string` | `null` | no |
| <a name="input_s3_read_buckets"></a> [s3\_read\_buckets](#input\_s3\_read\_buckets) | n/a | `list(any)` | `[]` | no |
| <a name="input_s3_write_buckets"></a> [s3\_write\_buckets](#input\_s3\_write\_buckets) | n/a | `list(any)` | `[]` | no |
| <a name="input_secrets_deletion_window"></a> [secrets\_deletion\_window](#input\_secrets\_deletion\_window) | Deletion Window for Secrets. Set to 0 for dev environments, or set from 7 to 30 | `number` | `7` | no |
| <a name="input_secrets_kms_key_arn"></a> [secrets\_kms\_key\_arn](#input\_secrets\_kms\_key\_arn) | ARN for KMS key used for Secrets. If not specified, one will be created | `string` | `null` | no |
| <a name="input_tags"></a> [tags](#input\_tags) | Tags to add to infrastructure resources | `map(string)` | `{}` | no |
| <a name="input_unit_testing"></a> [unit\_testing](#input\_unit\_testing) | Use mock\_* vars instead of data sources for unit testing | `bool` | `false` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_eks_cluster"></a> [eks\_cluster](#output\_eks\_cluster) | n/a |
| <a name="output_helm_sa_annotation"></a> [helm\_sa\_annotation](#output\_helm\_sa\_annotation) | n/a |
| <a name="output_helm_secret_configs"></a> [helm\_secret\_configs](#output\_helm\_secret\_configs) | n/a |
| <a name="output_iam_users"></a> [iam\_users](#output\_iam\_users) | n/a |
| <a name="output_name"></a> [name](#output\_name) | n/a |
| <a name="output_secrets_cdr_regcred"></a> [secrets\_cdr\_regcred](#output\_secrets\_cdr\_regcred) | n/a |
| <a name="output_secrets_kms_key"></a> [secrets\_kms\_key](#output\_secrets\_kms\_key) | n/a |
| <a name="output_url"></a> [url](#output\_url) | n/a |
